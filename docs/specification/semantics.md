# Спецификация семантики языка StarLight

## Область видимости

StarLight использует лекические (статические) области видимости. Область видимости определяется местом объявления в исходном коде.

**Уровни областей видимости:**
1. Глобальная область - переменные и функции, объявленные на верхнем уровне программы (вне всех блоков)
2. Область функции - параметры и переменные, объявленные внутри функции
3. Блочная область - перменные, объявленные внутри блоков `{...}` (if, while, for, произвольные блоки).

**Правила видимости**
- Внутренние области видят переменные из внешних областей
- Внешние области НЕ видят переменные из внутренних областей
- Переменные уничтожаются при выходе из своей области видимости
- Функции НЕ захватывают переменные внешних областей

Пример:
```
ЗВЕЗДА
    СВЕТ глобальная: квазар = 10;  // Глобальная область
    
    ФОТОН тест() {
        СВЕТ локальная: квазар = 20;  // Область функции
        // Видны: глобальная, локальная
    }
    
    ЕСЛИ (истина) {
        СВЕТ блочная: квазар = 30;  // Блочная область
        // Видны: глобальная, блочная
    }
    // Здесь НЕ видна блочная
ЗАКРЫТАЯ_ЗВЕЗДА
```

## Уникальность имён

1. В пределах одной области видимости имя должно быть уникальным
2. Переменные и функции используют общее пространство имён
3. Shadowing разрешено - можно объявить переменную с тем же именем, что и во внешней области
4. Имена типов защищены - нельзя объявить переменную с именем типа (`квазар`, `нова` и т.д.)

Пример:
```
ЗВЕЗДА
    СВЕТ x: квазар = 10;  // Глобальная x
    
    ФОТОН тест() {
        СВЕТ x: квазар = 20;  // Локальная x (shadowing)
        // Внутри функции x = 20, глобальная x скрыта
    }
    
    // Здесь x = 10 (глобальная)
ЗАКРЫТАЯ_ЗВЕЗДА
```

Запрщено:
```
ЗВЕЗДА
    СВЕТ x: квазар = 10;
    СВЕТ x: нова = 3.14;  // Ошибка: повторное объявление в одной области
ЗАКРЫТАЯ_ЗВЕЗДА
```

## Параметры функций

**Передача параметров**
- Параметры передаются по значению
- Параметры являются локальными переменными функции
- Параметра immutable - им нельзя присвоить новое значение внутри функции

**Семантика вызова**
1. Порядок вычисления аргументов: слева направо
2. Количество аргументов должно совпадать с количеством параметров
3. Типы аргументов должны быть совместимы с типами параметров

Пример:
```
ЗВЕЗДА
    ФОТОН сумма(a: квазар, b: квазар): квазар {
        ВЕРНУТЬ a + b;  // a и b - локальные копии
    }
    
    СВЕТ x: квазар = 5;
    СВЕТ y: квазар = 10;
    СВЕТ результат: квазар = сумма(x, y);  // x и y не изменяются
ЗАКРЫТАЯ_ЗВЕЗДА
```

**Завершение функций**
- Функция с возвращаемым значением обязана иметь оператор `ВЕРНУТЬ`
- Функция без возвращаемого значения может завершиться без `ВЕРНУТЬ`
- `ВЕРНУТЬ` без значения возвращает `ЛОЖЬ` (неявное значение `вакуум`)

## Рекурсия

Поддерживатеся:
- Прямая рекурсия
- Взаимная рекурсия
- Глубина рекурсии ограничена только стеком вызовов

Пример прямой рекурсии:
```
ЗВЕЗДА
    ФОТОН факториал(n: квазар): квазар {
        ЕСЛИ (n <= 1) {
            ВЕРНУТЬ 1;
        } ИЛИ_НЕТ {
            ВЕРНУТЬ n * факториал(n - 1);
        }
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

Пример взаимной рекурсии:
```
ЗВЕЗДА
    ФОТОН четное(n: квазар): вакуум;
    ФОТОН нечетное(n: квазар): вакуум;
    
    ФОТОН четное(n: квазар): вакуум {
        ЕСЛИ (n == 0) {
            ВЕРНУТЬ ИСТИНА;
        } ИЛИ_НЕТ {
            ВЕРНУТЬ нечетное(n - 1);
        }
    }
    
    ФОТОН нечетное(n: квазар): вакуум {
        ЕСЛИ (n == 0) {
            ВЕРНУТЬ ЛОЖЬ;
        } ИЛИ_НЕТ {
            ВЕРНУТЬ четное(n - 1);
        }
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

## Ветвления

**Семантика условий**
- Тип условия: только `вакуум` (булевский)
- Истина: `ИСТИНА`
- Ложь: `ЛОЖЬ`
- Автоматического приведения других типов к `вакуум` нет
  
**Выполнение веток:**
- При *истинном* условии выполняется блок после `ЕСЛИ`
- При *ложном* условии выполняется блок после `ИЛИ_НЕТ`
- Цепочки `ИЛИ_НЕТ ЕСЛИ` обрабатываются последовательно

Пример:
```
ЗВЕЗДА
    СВЕТ x: квазар = 10;
    
    ЕСЛИ (x > 20) {
        ИЗЛУЧАТЬ("Больше 20");
    } ИЛИ_НЕТ ЕСЛИ (x > 5) {
        ИЗЛУЧАТЬ("Больше 5, но не больше 20");  // Выполнится эта ветка
    } ИЛИ_НЕТ {
        ИЗЛУЧАТЬ("5 или меньше");
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

**Решение проблемы висячего else:**
`ИЛИ_НЕТ` всегда связывается с ближайшим предыдущим `ЕСЛИ`, не имеющим своего `ИЛИ_НЕТ`.

## Циклы

**Цикл `ОРБИТА` (while)**
- Условие: только тип `вакуум`
- Проверка: перед каждой итерацией
- Завершение: когда условие становится `ЛОЖЬ`
- Бесконечный цикл: `ОРБИТА (ИСТИНА) { ... }`

Пример:
```
ЗВЕЗДА
    СВЕТ счетчик: квазар = 0;
    
    ОРБИТА (счетчик < 5) {
        ИЗЛУЧАТЬ(счетчик);
        счетчик = счетчик + 1;
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

**Цикл `СПЕКТР` (for):**
Синтаксис: `СПЕКТР (инициализация; условие; обновление) { тело }`

Семантика:
1. Инициализация (выполняется 1 раз в начале)
2. Проверка условия (тип `вакуум`)
3. Если истина → выполнить тело цикла
4. Обновление
5. Вернуться к шагу 2

Пример:
```
ЗВЕЗДА
    СПЕКТР (СВЕТ i: квазар = 0; i < 5; i = i + 1) {
        ИЗЛУЧАТЬ(i);
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

**Инструкции управления циклом:**
- `ПРЕРВАТЬ` - немедленный выход из текущего цикла
- `ПРОДОЛЖИТЬ` - переход к следующей итерации текущего цикла
- Ограничения: могут использоваться только внутри циклов

Пример:
```
ЗВЕЗДА
    СВЕТ i: квазар = 0;
    
    ОРБИТА (i < 10) {
        i = i + 1;
        
        ЕСЛИ (i == 3) {
            ПРОДОЛЖИТЬ;  // Пропустит вывод для i=3
        }
        
        ЕСЛИ (i == 7) {
            ПРЕРВАТЬ;  // Выйдет из цикла при i=7
        }
        
        ИЗЛУЧАТЬ(i);
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

## Прочие правила

**Присваивания:**
- Левая часть: только идентификатор переменной
- Нельзя присваивать константам (`КОНСТЕЛЛАЦИЯ`)
- Нельзя присваивать параметрам функций

Примеры:
```
// Допустимо:
СВЕТ x: квазар;
x = 10;

// НЕ допустимо:
5 = x;                     // литерал слева
КОНСТЕЛЛАЦИЯ c: квазар = 5;
c = 10;                    // константе нельзя присвоить

ФОТОН тест(a: квазар) {
    a = 20;                // параметру нельзя присвоить
}
```

**Инициализация перменных**
- Обязательна для констант (`КОНСТЕЛЛАЦИЯ`)
- Запрещено обращение к неинициализированным переменным
- Локальные переменные ложны быть инициализированы перед использованием

Пример:
```
ЗВЕЗДА
    СВЕТ x: квазар;        // Ошибка компиляции: не инициализирована
    СВЕТ y: квазар = 10;   // OK
    
    ЕСЛИ (y > 5) {
        СВЕТ z: квазар;    // OK, если не используется
        z = 20;            // Теперь инициализирована
        ИЗЛУЧАТЬ(z);       // OK
    }
ЗАКРЫТАЯ_ЗВЕЗДА
```

**Ввод-вывод:**
- `ИЗЛУЧАТЬ` автоматически преобразует аргументы к строке
- `ПРИЕМ_СИГНАЛА` пытается преобразовать ввод к типу переменной
- Ошибка выполнения при несовпадении типов в `ПРИЕМ_СИГНАЛА`